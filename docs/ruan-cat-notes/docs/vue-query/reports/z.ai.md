# @tanstack/vue-query å­¦ä¹ èµ„æºä¸é¡¹ç›®æ¨è

è¿™ä»½æ–‡æ¡£æ—¨åœ¨å¸®åŠ©ä½ å¿«é€Ÿå­¦ä¹  `@tanstack/vue-query` çš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶å°†å…¶æˆåŠŸåº”ç”¨äºä½ çš„é¡¹ç›®ä¸­ã€‚å†…å®¹æ¶µç›–äº†å¤šç§é¡¹ç›®ç±»å‹ï¼Œå¹¶ç²¾é€‰äº†æ¥è‡ª GitHub çš„é«˜è´¨é‡ä»“åº“å’Œå­¦ä¹ èµ„æºã€‚

## ğŸ“Š ç²¾é€‰é¡¹ç›®ä¸èµ„æºä¸€è§ˆ

ä¸‹è¡¨æ±‡æ€»äº†æ¨èçš„ GitHub ä»“åº“ã€å®˜æ–¹ç¤ºä¾‹åŠæ•™ç¨‹ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„é¡¹ç›®ç±»å‹å’Œå…´è¶£ç‚¹è¿›è¡Œé€‰æ‹©ã€‚

| é¡¹ç›®åç§°/é“¾æ¥                                                                                                                                                  | é¡¹ç›®ç±»å‹       | Stars                                                                                 | ä¸»è¦ç‰¹ç‚¹ä¸é€‚ç”¨åœºæ™¯                                                                                 |
| :------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------- | :------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------- |
| **[vue-query-nuxt](https://github.com/Hebilicious/vue-query-nuxt)**                                                                                            | Nuxt æ¨¡å—      | ![Stars](https://img.shields.io/github/stars/Hebilicious/vue-query-nuxt?style=social) | è½»é‡çº§ã€é›¶é…ç½®çš„å®˜æ–¹ Nuxt æ¨¡å—ï¼Œæå¤§ç®€åŒ–äº†åœ¨ Nuxt 3 ä¸­çš„é›†æˆè¿‡ç¨‹ã€‚                                 |
| **[nuxt-query](https://github.com/peterbud/nuxt-query)**                                                                                                       | Nuxt æ¨¡å—      | ![Stars](https://img.shields.io/github/stars/peterbud/nuxt-query?style=social)        | ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Nuxt æ¨¡å—ï¼Œä¸º TanStack Query æä¾›äº†å®Œå–„çš„æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†æ”¯æŒã€‚                       |
| **[TanStack Query å®˜æ–¹ç¤ºä¾‹ - Nuxt3](https://tanstack.com/query/latest/docs/framework/vue/examples/nuxt3)**                                                     | Nuxt 3 ç¤ºä¾‹    | -                                                                                     | TanStack å®˜æ–¹æä¾›çš„ Nuxt 3 é›†æˆç¤ºä¾‹ï¼Œæ˜¯å­¦ä¹  SSR/SSG ç¯å¢ƒä¸‹æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†çš„æƒå¨å‚è€ƒã€‚           |
| **[å¦‚ä½•åœ¨ Nuxt 3 ä¸­ä½¿ç”¨ Vue Query](https://medium.com/@imanmalekian31/how-to-use-tanstack-vue-query-with-usefetch-in-nuxt-3-9e90da3fcac1)**                    | æ•™ç¨‹ä¸ä»£ç ç¤ºä¾‹ | -                                                                                     | ä¸€ç¯‡éå¸¸è¯¦ç»†çš„æ•™ç¨‹ï¼ŒåŒ…å« `useQuery` å’Œ `useMutation` çš„å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œéå¸¸é€‚åˆå®è·µã€‚                |
| **[TanStack Query å®˜æ–¹ç¤ºä¾‹ - Vue Basic](https://tanstack.com/query/v5/docs/framework/vue/examples/basic)**                                                     | Vue (Vite)     | -                                                                                     | å®˜æ–¹åŸºç¡€ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†æœ€æ ¸å¿ƒçš„ `useQuery` ç”¨æ³•ï¼Œæ˜¯åˆå­¦è€…çš„æœ€ä½³èµ·ç‚¹ã€‚                                 |
| **[Vue Query + TypeScript ç¤ºä¾‹](https://github.com/TanStack/query/issues/6318)**                                                                               | Vue (Vite)     | -                                                                                     | ä¸€ä¸ª GitHub Issue è®¨è®ºäº†åœ¨ Vue 3 + TypeScript ç¯å¢ƒä¸‹å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œå¯¹ TS ç”¨æˆ·å¾ˆæœ‰å¸®åŠ©ã€‚ |
| **[ä½¿ç”¨ MSW æµ‹è¯• Vue Query](https://github.com/mswjs/msw/discussions/2303)**                                                                                   | æµ‹è¯•           | -                                                                                     | å±•ç¤ºäº†å¦‚ä½•ç»“åˆ MSW (Mock Service Worker) å’Œ Vitest æ¥ä¸ºä½ çš„ Vue Query é€»è¾‘ç¼–å†™å•å…ƒæµ‹è¯•ã€‚           |
| **[åŸºäº URL å‚æ•°è·å–æ•°æ®](https://github.com/TanStack/query/discussions/4265)**                                                                                | Vue Router     | -                                                                                     | å®˜æ–¹è®¨è®ºåŒºçš„ä¸€ä¸ªè¯é¢˜ï¼Œå±•ç¤ºäº†å¦‚ä½•ç»“åˆ Vue Routerï¼Œæ ¹æ®è·¯ç”±å‚æ•°ï¼ˆå¦‚ `:id`ï¼‰æ¥è·å–æ•°æ®ã€‚              |
| **[Vue Query åˆ†é¡µä¸æ— é™æ»šåŠ¨](https://www.youtube.com/watch?v=0Njxq9UcL9s)**                                                                                    | è§†é¢‘æ•™ç¨‹       | -                                                                                     | è§†é¢‘æ•™ç¨‹ï¼Œç”ŸåŠ¨åœ°è®²è§£äº†å¦‚ä½•ä½¿ç”¨ Vue Query å®ç°åˆ†é¡µå’Œæ— é™æ»šåŠ¨åŠŸèƒ½ã€‚                                  |
| **[ä¼˜åŒ– Vue 3 æ•°æ®è·å–](https://medium.com/@petrankar/master-efficient-data-fetching-in-vue3-with-tanstack-query-flow-diagram-code-walkthrough-f59bb6875247)** | æœ€ä½³å®è·µ       | -                                                                                     | ä¸€ç¯‡æ·±åº¦æ–‡ç« ï¼Œæ¢è®¨äº†æ•°æ®è·å–çš„ä¼˜åŒ–ç­–ç•¥å’Œæ¨¡å¼ï¼Œå¹¶é…æœ‰æµç¨‹å›¾å’Œä»£ç è®²è§£ã€‚                             |

---

## ğŸ”§ å„ç±»é¡¹ç›®é›†æˆè¦ç‚¹

### 1. Nuxt 3 (å…¨æ ˆæ¡†æ¶)

åœ¨ Nuxt 3 ä¸­ä½¿ç”¨ `@tanstack/vue-query` çš„ä¸»è¦æŒ‘æˆ˜æ˜¯å¤„ç†æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„æ•°æ®é¢„å–å’Œå®¢æˆ·ç«¯çš„æ°´åˆã€‚

- **æ¨èæ–¹å¼**ï¼šå¼ºçƒˆå»ºè®®ä½¿ç”¨ä¸Šè¿°çš„ **[vue-query-nuxt](https://github.com/Hebilicious/vue-query-nuxt)** æˆ– **[nuxt-query](https://github.com/peterbud/nuxt-query)** æ¨¡å—ã€‚å®ƒä»¬ä¸ºä½ å¤„ç†äº†æ‰€æœ‰å¤æ‚çš„ SSR é€»è¾‘ï¼ˆå¦‚æ•°æ®è„±æ°´ `dehydrate` å’Œæ°´åˆ `hydrate`ã€turn0search5ã€‘ï¼‰ï¼Œè®©ä½ èƒ½åƒåœ¨æ™®é€š Vue åº”ç”¨ä¸­ä¸€æ ·ä½¿ç”¨ `useQuery`ã€‚
- **æ‰‹åŠ¨é›†æˆ**ï¼šå¦‚æœä¸ä½¿ç”¨æ¨¡å—ï¼Œä½ éœ€è¦å‚è€ƒå®˜æ–¹ç¤ºä¾‹ã€turn0search6ã€‘ã€turn0search17ã€‘ï¼Œåœ¨æœåŠ¡ç«¯æ’ä»¶ä¸­é¢„å–æŸ¥è¯¢ï¼Œå¹¶å°†çŠ¶æ€ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚è¿™éœ€è¦æ›´æ·±å…¥çš„ç†è§£ã€‚

### 2. Vite + Vue (å•é¡µåº”ç”¨ - SPA)

è¿™æ˜¯æœ€ç›´æ¥çš„é›†æˆæ–¹å¼ï¼Œéå¸¸é€‚åˆå¿«é€Ÿä¸Šæ‰‹ã€‚

1.  **å®‰è£…**:

```bash
npm i @tanstack/vue-query
```

2.  **é…ç½®**: åœ¨ä½ çš„åº”ç”¨å…¥å£æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `src/main.ts`ï¼‰ä¸­æ³¨å†Œæ’ä»¶ã€‚

```typescript
// src/main.ts
import { createApp } from "vue";
import { VueQueryPlugin } from "@tanstack/vue-query";
import App from "./App.vue";

const app = createApp(App);

app.use(VueQueryPlugin); // é»˜è®¤é…ç½®å³å¯å¼€å§‹ä½¿ç”¨
app.mount("#app");
```

3.  **ä½¿ç”¨**: åœ¨ä»»ä½•ç»„ä»¶ä¸­ä½¿ç”¨ `useQuery`ã€‚

```vue
<script setup lang="ts">
import { useQuery } from "@tanstack/vue-query";

// è·å–å¾…åŠäº‹é¡¹åˆ—è¡¨
const { data, isLoading, error } = useQuery({
	queryKey: ["todos"], // å”¯ä¸€çš„æŸ¥è¯¢é”®
	queryFn: () => fetch("https://api.example.com/todos").then((res) => res.json()), // è·å–æ•°æ®çš„å‡½æ•°
});
</script>
```

### 3. Vite + Nitro (æ··åˆå…¨æ ˆ)

åœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œä½ çš„å‰ç«¯ï¼ˆViteï¼‰å’Œåç«¯ï¼ˆNitroï¼‰æ˜¯åˆ†ç¦»çš„ã€‚

- **å‰ç«¯éƒ¨åˆ†**: é›†æˆæ–¹å¼ä¸ **Vite + Vue (SPA)** å®Œå…¨ç›¸åŒã€‚ä½ åªéœ€è¦åœ¨ä½ çš„ `queryFn` ä¸­ç¡®ä¿ API åœ°å€æŒ‡å‘ä½ çš„ Nitro åç«¯æœåŠ¡å³å¯ã€‚
- **åç«¯éƒ¨åˆ†**: Nitro è´Ÿè´£æä¾› API ç«¯ç‚¹ï¼Œå‰ç«¯é€šè¿‡ `@tanstack/vue-query` æ¥æ¶ˆè´¹è¿™äº› APIã€‚

### 4. UniApp (è·¨å¹³å°åº”ç”¨)

åœ¨ UniApp ä¸­ä½¿ç”¨ `@tanstack/vue-query` å®Œå…¨å¯è¡Œï¼Œå…³é”®åœ¨äº**è¯·æ±‚åº“çš„é€‚é…**ã€‚

- `@tanstack/vue-query` æœ¬èº«ä¸å…³å¿ƒè¯·æ±‚æ˜¯å¦‚ä½•å‘å‡ºçš„ï¼Œå®ƒåªç®¡ç†å¼‚æ­¥çŠ¶æ€ã€‚
- ä½ éœ€è¦å°† UniApp çš„è¯·æ±‚å‡½æ•°ï¼ˆå¦‚ `uni.request`ï¼‰å°è£…æˆä¸€ä¸ªè¿”å› Promise çš„ `fetcher` å‡½æ•°ï¼Œç„¶ååœ¨ `queryFn` ä¸­è°ƒç”¨å®ƒã€‚

**ç¤ºä¾‹å°è£…ï¼š**

```javascript
// utils/fetcher.js
export function uniRequestFetcher(url, options = {}) {
	return new Promise((resolve, reject) => {
		uni.request({
			url,
			...options,
			success: (res) => {
				if (res.statusCode >= 200 && res.statusCode < 300) {
					resolve(res.data);
				} else {
					reject(new Error(`Request failed with status code ${res.statusCode}`));
				}
			},
			fail: (err) => {
				reject(err);
			},
		});
	});
}
```

**åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š**

```vue
<script setup>
import { useQuery } from "@tanstack/vue-query";
import { uniRequestFetcher } from "@/utils/fetcher";

const { data, isLoading } = useQuery({
	queryKey: ["user", 1],
	queryFn: () => uniRequestFetcher("https://api.example.com/user/1"),
});
</script>
```

---

## ğŸ’¡ å­¦ä¹ å»ºè®®ä¸èµ„æº

1.  **ç†è§£æ ¸å¿ƒæ¦‚å¿µ**: æŒæ¡ `useQuery`, `queryKey`, `queryFn` è¿™ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯å…³é”®ã€turn0search25ã€‘ã€‚
    - `queryKey`: æŸ¥è¯¢çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç¼“å­˜ã€é‡æ–°è·å–å’Œå…±äº«æŸ¥è¯¢ã€‚
    - `queryFn`: ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°ï¼Œç”¨äºè·å–æ•°æ®ã€‚
    - `useQuery`: ä¸€ä¸ª Hookï¼Œå®ƒå°† `queryKey` å’Œ `queryFn` è¿æ¥èµ·æ¥ï¼Œå¹¶è¿”å› `data`, `isLoading`, `error` ç­‰æœ‰ç”¨çš„çŠ¶æ€ã€‚

2.  **å–„ç”¨ DevTools**: å®‰è£…å¹¶ä½¿ç”¨ [Vue DevTools æµè§ˆå™¨æ‰©å±•](https://devtools.vuejs.org/)ã€‚`@tanstack/vue-query` æä¾›äº†å®˜æ–¹é›†æˆï¼Œä½ å¯ä»¥åœ¨ DevTools çš„ "Plugins" æˆ– "TanStack Query" é¢æ¿ä¸­æŸ¥çœ‹æ‰€æœ‰æŸ¥è¯¢çš„å®æ—¶çŠ¶æ€ã€ç¼“å­˜æ•°æ®ç­‰ï¼Œè¿™å¯¹è°ƒè¯•å’Œç†è§£å…¶å·¥ä½œåŸç†éå¸¸æœ‰å¸®åŠ©ã€‚

3.  **å‚è€ƒå®˜æ–¹æ–‡æ¡£**: [TanStack Query Vue å®˜æ–¹æ–‡æ¡£](https://tanstack.com/query/latest/docs/vue/overview) æ˜¯æœ€æƒå¨å’Œå…¨é¢çš„èµ„æºï¼ŒåŠ¡å¿…æ—¶å¸¸æŸ¥é˜…ã€turn0search1ã€‘ã€‚

4.  **å®è·µä¸æ¢ç´¢**: ä»å…‹éš†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼ˆå¦‚å®˜æ–¹ Basic ç¤ºä¾‹ï¼‰å¼€å§‹ï¼Œç„¶åå°è¯•åœ¨ä½ è‡ªå·±çš„é¡¹ç›®ä¸­å®ç°ä¸€ä¸ªç®€å•çš„æ•°æ®è·å–åŠŸèƒ½ã€‚é€æ­¥æ¢ç´¢åˆ†é¡µã€æ— é™æ»šåŠ¨ã€ä¹è§‚æ›´æ–°ç­‰é«˜çº§ç‰¹æ€§ã€‚

å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½ä¸ºä½ æä¾›ä¸€æ¡æ¸…æ™°çš„å­¦ä¹ è·¯å¾„ã€‚ç¥ä½ ç¼–ç æ„‰å¿«ï¼
